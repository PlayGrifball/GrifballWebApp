#!/usr/bin/env node

/**
 * This script automatically generates the coverage-import.spec.ts file
 * by scanning all TypeScript files in the src/app directory.
 * 
 * Run this script before running tests to ensure all files are included in coverage.
 * 
 * Usage: node generate-coverage-imports.js
 */

const fs = require('fs');
const path = require('path');

const appDir = path.join(__dirname, 'src', 'app');
const outputFile = path.join(appDir, 'coverage-import.spec.ts');

// Recursively find all .ts files excluding spec files
function findTypeScriptFiles(dir, fileList = []) {
  const files = fs.readdirSync(dir);
  
  files.forEach(file => {
    const filePath = path.join(dir, file);
    const stat = fs.statSync(filePath);
    
    if (stat.isDirectory()) {
      findTypeScriptFiles(filePath, fileList);
    } else if (file.endsWith('.ts') && !file.endsWith('.spec.ts') && !file.endsWith('.d.ts') && file !== 'coverage-import.spec.ts') {
      // Get relative path from the app directory
      const relativePath = './' + path.relative(appDir, filePath).replace(/\\/g, '/').replace(/\.ts$/, '');
      fileList.push(relativePath);
    }
  });
  
  return fileList;
}

// Generate the imports
const files = findTypeScriptFiles(appDir).sort();

const fileContent = `/**
 * This file is AUTO-GENERATED by generate-coverage-imports.js
 * DO NOT EDIT MANUALLY
 * 
 * This file ensures all source files are included in code coverage,
 * even if they don't have their own test files.
 * 
 * To regenerate: npm run generate-coverage-imports
 */

${files.map(file => `import '${file}';`).join('\n')}

describe('Coverage Import', () => {
  it('should import all source files for coverage', () => {
    // This test doesn't need to do anything - it just needs to exist
    // so that all the imports above are processed by the test runner
    expect(true).toBe(true);
  });
});
`;

fs.writeFileSync(outputFile, fileContent);
console.log(`âœ“ Generated ${outputFile} with ${files.length} imports`);
